-- Acorn Auto-Collect Script - Modified Version with Teleport
-- By: Hussain (Modified by Gemini for Teleport)
-- For Delta Executor

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local scriptEnabled = false
local searchConnection = nil
local lastSearchTime = 0
local searchInterval = 0.3 -- قللت الوقت بين كل بحث حتى يصير التجميع أسرع وأسرع

-- تحسينات للأداء
local cachedAcorn = nil
local lastCacheTime = 0
local cacheDuration = 1.5 -- ثواني بين كل تحديث للكاش

local isTeleporting = false -- متغير لمنع تيليبورت متكرر
local teleportOffset = Vector3.new(0, 3, 0) -- المسافة اللي يوقف بيها اللاعب فوق الـ Acorn

-- إنشاء واجهة المستخدم (نفس الواجهة بدون تغييرات كبيرة)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AcornTeleportGUI"
ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 260, 0, 160)
MainFrame.Position = UDim2.new(0.5, -130, 0.5, -80)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
MainFrame.BackgroundTransparency = 0.1
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 12)
Corner.Parent = MainFrame

local Stroke = Instance.new("UIStroke")
Stroke.Color = Color3.fromRGB(80, 80, 100)
Stroke.Thickness = 2
Stroke.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 0, 35)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
-- غيرت النص لشيء مناسب أكثر للسكربت
Title.Text = "Acorn Auto-Collect ⚡ (Teleport)" 
Title.Font = Enum.Font.GothamBold
Title.TextSize = 12
Title.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = Title

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Size = UDim2.new(1, -20, 0, 25)
StatusLabel.Position = UDim2.new(0, 10, 0, 40)
StatusLabel.BackgroundTransparency = 1
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.Text = "Status: OFF"
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 12
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = MainFrame

local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0, 120, 0, 35)
ToggleButton.Position = UDim2.new(0.5, -60, 0, 70)
ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Text = "START"
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 14
ToggleButton.AutoButtonColor = false
ToggleButton.Parent = MainFrame

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 8)
ToggleCorner.Parent = ToggleButton

local ButtonStroke = Instance.new("UIStroke")
ButtonStroke.Color = Color3.fromRGB(150, 150, 150)
ButtonStroke.Thickness = 1
ButtonStroke.Parent = ToggleButton

local InfoLabel = Instance.new("TextLabel")
InfoLabel.Name = "InfoLabel"
InfoLabel.Size = UDim2.new(1, -20, 0, 30)
InfoLabel.Position = UDim2.new(0, 10, 0, 110)
InfoLabel.BackgroundTransparency = 1
InfoLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
-- تم تعديل النص ليناسب خاصية التيليبورت
InfoLabel.Text = "يجمع الـ Acorn تلقائياً باستخدام التليبورت السريع" 
InfoLabel.Font = Enum.Font.Gotham
InfoLabel.TextSize = 10
InfoLabel.TextXAlignment = Enum.TextXAlignment.Left
InfoLabel.Parent = MainFrame

local CreditsLabel = Instance.new("TextLabel")
CreditsLabel.Name = "CreditsLabel"
CreditsLabel.Size = UDim2.new(0, 120, 0, 15)
CreditsLabel.Position = UDim2.new(1, -125, 1, -18)
CreditsLabel.BackgroundTransparency = 1
CreditsLabel.TextColor3 = Color3.fromRGB(100, 100, 120)
CreditsLabel.Text = "Made by Hussain"
CreditsLabel.Font = Enum.Font.Gotham
CreditsLabel.TextSize = 10
CreditsLabel.TextXAlignment = Enum.TextXAlignment.Right
CreditsLabel.Parent = MainFrame

-- تأثيرات hover على الأزرار (نفسها)
ToggleButton.MouseEnter:Connect(function()
    if scriptEnabled then
        TweenService:Create(ToggleButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(80, 220, 80)}):Play()
    else
        TweenService:Create(ToggleButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(240, 80, 80)}):Play()
    end
end)

ToggleButton.MouseLeave:Connect(function()
    if scriptEnabled then
        TweenService:Create(ToggleButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 220, 60)}):Play()
    else
        TweenService:Create(ToggleButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(220, 60, 60)}):Play()
    end
end)

-- نظام تحريك سلس للقائمة (نفسه)
local isDragging = false
local dragStart, frameStart

local function smoothDrag(input)
    if not isDragging then return end
    local delta = input.Position - dragStart
    local newPosition = UDim2.new(frameStart.X.Scale, frameStart.X.Offset + delta.X, frameStart.Y.Scale, frameStart.Y.Offset + delta.Y)
    TweenService:Create(MainFrame, TweenInfo.new(0.03, Enum.EasingStyle.Linear, Enum.EasingDirection.Out), {Position = newPosition}):Play()
end

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isDragging = true
        dragStart = input.Position
        frameStart = MainFrame.Position
        TweenService:Create(MainFrame, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                isDragging = false
                TweenService:Create(MainFrame, TweenInfo.new(0.1), {BackgroundTransparency = 0.1}):Play()
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        smoothDrag(input)
    end
end)

-- زر التشغيل/الإيقاف (نفسه)
ToggleButton.MouseButton1Click:Connect(function()
    scriptEnabled = not scriptEnabled
    if scriptEnabled then
        TweenService:Create(ToggleButton, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(60, 220, 60), Size = UDim2.new(0, 115, 0, 33)}):Play()
        ToggleButton.Text = "STOP"
        StatusLabel.Text = "Status: ON - Searching..."
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        startSearching()
    else
        TweenService:Create(ToggleButton, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(220, 60, 60), Size = UDim2.new(0, 120, 0, 35)}):Play()
        ToggleButton.Text = "START"
        StatusLabel.Text = "Status: OFF"
        StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        stopSearching()
    end
end)

-- وظيفة البحث عن Acorn (تم تحسينها)
function findAcorn()
    local currentTime = tick()
    if cachedAcorn and cachedAcorn.Parent and (currentTime - lastCacheTime) < cacheDuration then
        return cachedAcorn
    end
    
    local foundAcorn = nil
    -- البحث في الـ Workspace بالكامل
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj.Name == "Acorn" and obj:IsA("BasePart") and obj.CanCollide == false then
            -- نعتبر هذا Acorn قابل للتجميع
            foundAcorn = obj
            break
        end
    end
    
    if foundAcorn then
        cachedAcorn = foundAcorn
        lastCacheTime = currentTime
    end
    return foundAcorn
end

---
-- [[[[ التعديلات المهمة هنا: دالة التيليبورت الجديدة ]]]]
---

-- وظيفة جديدة للـ Teleport للـ Acorn (تم تحسينها)
function teleportToAcorn(acornPart)
    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") and acornPart and acornPart.Parent then
        local HRP = character.HumanoidRootPart
        
        isTeleporting = true
        StatusLabel.Text = "Status: ON - Teleporting..."
        
        local targetPosition = acornPart.CFrame.Position + teleportOffset
        
        -- إعدادات التيليبورت: نستخدم CFrame مباشرة للتنقل السريع
        HRP.CFrame = CFrame.new(targetPosition)
        
        -- إعطاء فرصة قصيرة للسيرفر لاكتشاف التجميع (اللمس)
        wait(0.1) 
        
        -- التيليبورت مجدداً لمكان بعيد قليلاً لتجنب التجميع المتكرر
        -- أو ممكن ترجع اللاعب لمكانه الأصلي أو تخليه بمكانه اذا ماكو مشاكل
        -- HRP.CFrame = CFrame.new(HRP.Position + Vector3.new(0, 10, 0))
        
        isTeleporting = false
        return true
    end
    isTeleporting = false
    return false
end

-- بدء البحث (تم تعديله ليستخدم دالة الـ Teleport)
function startSearching()
    if searchConnection then
        searchConnection:Disconnect()
    end
    
    searchConnection = RunService.Heartbeat:Connect(function()
        local currentTime = tick()
        
        if (currentTime - lastSearchTime) >= searchInterval and not isTeleporting then
            lastSearchTime = currentTime
            
            local acorn = findAcorn()
            if acorn then
                StatusLabel.Text = "Status: ON - Acorn Found! Teleporting..."
                
                -- استدعاء دالة التيليبورت
                local success = teleportToAcorn(acorn)
                
                if success then
                    StatusLabel.Text = "Status: ON - Collected! Searching again..."
                end
                
                cachedAcorn = nil -- نمسح الكاش حتى يبحث عن واحد جديد فوراً
            else
                StatusLabel.Text = "Status: ON - Searching..."
            end
        end
    end)
end

-- إيقاف البحث (تم تعديله)
function stopSearching()
    if searchConnection then
        searchConnection:Disconnect()
        searchConnection = nil
    end
    cachedAcorn = nil
    isTeleporting = false
end

-- إغلاق سلس للسكربت (نفسه)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.Escape and not gameProcessed then
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {Size = UDim2.new(0, 0, 0, 0), Position = UDim2.new(0.5, 0, 0.5, 0), BackgroundTransparency = 1}):Play()
        TweenService:Create(Title, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
        TweenService:Create(StatusLabel, TweenInfo.new(0.3), {TextTransparency = 1}):Play()
        TweenService:Create(ToggleButton, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
        TweenService:Create(InfoLabel, TweenInfo.new(0.3), {TextTransparency = 1}):Play()
        TweenService:Create(CreditsLabel, TweenInfo.new(0.3), {TextTransparency = 1}):Play()
        
        wait(0.3)
        stopSearching()
        ScreenGui:Destroy()
    end
end)

-- تأثير ظهور سلس عند البدء (نفسه)
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.BackgroundTransparency = 1
TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 260, 0, 160), Position = UDim2.new(0.5, -130, 0.5, -80), BackgroundTransparency = 0.1}):Play()

-- رسالة بدء التشغيل
print("Acorn Auto-Collect Script Loaded - Teleport Mode - Made by Hussain")
print("Press the START button to begin collecting Acorns")
print("Press ESC to close the script")
